document.addEventListener("DOMContentLoaded",(function(){const e=document.getElementById("form");function t(e){e.parentElement.classList.add("_error"),e.classList.add("_error")}function n(e){e.parentElement.classList.remove("_error"),e.classList.remove("_error")}function r(e){return!/^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$/.test(e.value.trim())}e.addEventListener("submit",(async function(o){o.preventDefault();let s=function(e){let a=0,i=document.querySelectorAll("._req");console.log("Fields to validate:",i);for(let e=0;e<i.length;e++){const o=i[e];o&&(n(o),o.classList.contains("_email")?r(o)&&(t(o),a++):"checkbox"!==o.getAttribute("type")||o.checked?""===o.value.trim()&&(t(o),a++):(t(o),a++))}return a}(),l=new FormData(e);if(l.append("image",a.files[0]),0===s){let t=await fetch("sendmail.php",{method:"POST",body:l});if(t.ok){e.classList.add("_sending");let n=await t.json();alert(n.message),i.innerHTML="",e.reset()}else e.classList.remove("_sending"),alert("Ошибка")}else alert("Заполните обязательные поля")}));const a=document.getElementById("formPhoto"),i=document.getElementById("formPreview");a.addEventListener("change",(()=>{!function(e){if(!["image/jpeg","image/png","image/gif"].includes(e.type))return alert("Разрешены только изображения"),void(a.value="");if(e.size>2097152)return void alert("Файл должен быть меньше 2 МБ.");let t=new FileReader;t.onload=function(e){i.innerHTML=`<img class="form__image" src="${e.target.result}" alt="Фото">`},t.onerror=function(e){alert("Ошибка")},t.readAsDataURL(e)}(a.files[0])}))}));